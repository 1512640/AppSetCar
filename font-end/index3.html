<!DOCTYPE html>
<html>
<head>
    <title>APP #3</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!--<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDMOaGHMCXMiyGrhu1HwVGLfhasIDVrj1M&callback=initMap&sensor=false"></script>-->
    <!--<script src="http://code.jquery.com/jquery-1.10.2.min.js" type="text/javascript"></script>-->
    
    <style>
        .div{
            position: relative;
        }
        .khungMap {
            width: 500px;
            height: 500px;
        }
        .status{

        }
        .center{
            position:absolute;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="app3">
            <div v-if="show">
                <h2 class="text-center">DANH SÁCH REQUEST</h2>
                <table class="table table-bordered" >
                    <thead class="thead-light">
                        <tr>
                            <th class="text-center" scope="col">Name</th>
                            <th class="text-center" scope="col">Address</th>
                            <th class="text-center" scope="col">Phone</th>
                            <th class="text-center" scope="col">Status</th>
                        </tr>
                    </thead>
                    <tbody v-for="c in customer">

                        <tr class="text-center">
                            <td>{{c.name}}</td>
                            <td scope="row">{{c.addr}}</td>
                            <td>{{c.sdt}}</td>
                            <td><span class="bg-success text-white" v-on:click="chiDan">Có xe nhận</span></td>
                        </tr>

                    </tbody>
                </table>
            </div>
            <div v-else="show" ><button @click="hienThiDanhSach" type="button" class="btn btn-primary center" ><h4>Quay về</h4></button></div>
        </div>
        <br />
        <div class="row" v-else="show">          
            <div id="googleMap" class="khungMap col-6"></div>
            <div id="instructions" class="col-6"></div>
        </div>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDMOaGHMCXMiyGrhu1HwVGLfhasIDVrj1M"
            async defer></script>

    <script type="text/javascript">
        function initMap() {
            var directionsDisplay;
            var directionsService;
            var hCm = new google.maps.LatLng(10.776530, 106.700980);
            var nhaTrang = new google.maps.LatLng(12.238791, 109.196747);
            var currentPosstion;
            //Khai bao cac thuoc tinh
            var mapProp = {
                //Tam ban do, quy dinh boi kinh do va vi do
                center: hCm,
                //set default zoom cua ban do khi duoc load
                zoom: 5,
                //Dinh nghia type
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            //Truyen tham so cho cac thuoc tinh Map cho the div chua Map
            var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
            var marker = new google.maps.Marker({
                position: nhaTrang,
                animation: google.maps.Animation.DRAG
            });
            marker.setMap(map);

            directionsService = new google.maps.DirectionsService();    // Khởi tạo DirectionsService - thằng này có nhiệm vụ tính toán chỉ đường cho chúng ta.
            directionsDisplay = new google.maps.DirectionsRenderer({ map: map });    // Khởi tạo DirectionsRenderer - thằng này có nhiệm vụ hiển thị chỉ đường trên bản đồ sau khi đã tính toán.

            calculateAndDisplayRoute(directionsService, directionsDisplay);    // Hàm xử lý và hiển thị kết quả chỉ đường

            function calculateAndDisplayRoute(directionsService, directionsDisplay) {
                directionsService.route({    // hàm route của DirectionsService sẽ thực hiện tính toán với các tham số truyền vào
                    origin: hCm,    // điểm xuất phát
                    destination: nhaTrang,    // điểm đích
                    travelMode: 'DRIVING',     // phương tiện di chuyển
                }, function (response, status) {    // response trả về bao gồm tất cả các thông tin về chỉ đường
                    if (status === google.maps.DirectionsStatus.OK) {
                        directionsDisplay.setDirections(response); // hiển thị chỉ đường trên bản đồ (nét màu đỏ từ A-B)
                        showSteps(response); // Hiển thị chi tiết các bước cần phải đi đến đích.
                    } else {
                        window.alert('Request for getting direction is failed due to ' + status);    // Hiển thị lỗi
                    }
                });
            }
            function showSteps(directionResult) {
                var myRoute = directionResult.routes[0].legs[0]; // Mình sẽ chỉ lấy 1 tuyến đường để hiển thị vì nó là tối ưu nhất cho người dùng.
                var instructions = '<h3 class="distance">Quãng đường: ' + myRoute.distance.text + '</h3><br>';
                instructions += '<h5 class="duration">Duration: ' + myRoute.duration.text + '</h5>';
                instructions += '<h5 class="start_address">From: ' + myRoute.start_address + '</h5>';
                instructions += '<h5 class="end_address">To: ' + myRoute.end_address + '</h5>';
                instructions += '<p class="steps"><ol>';

                for (var i = 0; i < myRoute.steps.length; i++) {
                    instructions += '<li>' + myRoute.steps[i].instructions + '</li>';
                }
                instructions += '</p></ol>';
                document.getElementById("instructions").innerHTML = instructions; // Đặt kết quả vào <div id="instructions">
            }
            window.app_info = {};
        }
        var ts = 0;
        LoadData();
        function LoadData() {
            var url = 'http://localhost:3000/getList';
            axios.get(url)
                .then(function (res) { //success

                    ts = res.data.return_ts;

                    var vm = new Vue({
                        el: '#app3',
                        data: {
                            show: true,
                            customer: res.data.inform,
                        },
                        methods: {
                            
                            chiDan: function () {
                                var self = this;
                                this.show = false;
                                initMap();                               
                            },
                            hienThiDanhSach: function () {
                                var self = this;
                                this.show = true;
                            }
                        }
                    })

                }).catch(function (err) {
                    alert(err);
                }).then(function () {
                    //setTimeout(LoadData, 3500);
                })
        };
    </script>  
</body>
</html>